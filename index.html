<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Personal & Safety Voice Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#020617;color:#fff}
header{padding:15px;text-align:center;font-size:18px;border-bottom:1px solid #1e293b}
.container{padding:15px}
button,input,textarea{width:100%;padding:12px;margin-top:8px;border-radius:8px;border:none;font-size:15px}
button{background:#22c55e;color:#000;font-weight:bold}
.card{border:1px solid #1e293b;border-radius:10px;padding:12px;margin-top:12px}
.log{background:#000;padding:10px;border-radius:6px;min-height:60px}
video{width:100%;display:none;border-radius:10px}
</style>
</head>
<body>

<header>ğŸ™ Personal & Safety Voice Assistant</header>

<div class="container">

<button onclick="startVoice()">â–¶ Start Voice Control</button>

<div class="card">
<b>Heard</b>
<div id="heard" class="log">Waitingâ€¦</div>
</div>

<div class="card">
<b>Response</b>
<div id="response" class="log">---</div>
</div>

<div class="card">
<b>ğŸ“ Location</b>
<div id="loc" class="log">Inactive</div>
</div>

<div class="card">
<b>ğŸ¥ Camera</b>
<video id="cam" autoplay playsinline></video>
</div>

<div class="card">
<b>ğŸ“ Test Form</b>
<input id="name" placeholder="Name">
<input id="note" placeholder="Note">
<button id="submitBtn" onclick="alert('Form Submitted!')">Submit</button>
</div>

</div>

<script>
/* ========= VOICE ENGINE ========= */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SR();
rec.continuous = true;
rec.interimResults = false;
rec.lang = navigator.language || "en-US";

let dictation = false;
let camStream = null;
let watchId = null;

function speak(text){
  speechSynthesis.cancel();
  let msg = new SpeechSynthesisUtterance(text);
  msg.rate = 1;
  msg.pitch = 1;
  msg.lang = rec.lang;
  speechSynthesis.speak(msg);
  response.innerText = text;
}

/* ========= CAMERA ========= */
async function openCamera(){
  if(camStream) return;
  camStream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
  cam.srcObject = camStream;
  cam.style.display = "block";
  speak("Camera turned on");
}
function closeCamera(){
  if(!camStream) return;
  camStream.getTracks().forEach(t=>t.stop());
  camStream = null;
  cam.style.display = "none";
  speak("Camera turned off");
}

/* ========= LOCATION ========= */
function startTracking(){
  if(watchId) return;
  watchId = navigator.geolocation.watchPosition(pos=>{
    loc.innerHTML = `Lat: ${pos.coords.latitude}<br>Lng: ${pos.coords.longitude}<br>Accuracy: ${pos.coords.accuracy}m`;
  });
  speak("Live location tracking started");
}
function stopTracking(){
  navigator.geolocation.clearWatch(watchId);
  watchId = null;
  loc.innerText = "Location tracking stopped";
  speak("Tracking stopped");
}

/* ========= COMMAND HANDLER ========= */
function handle(cmd){
  heard.innerText = cmd;

  // Dictation mode
  if(dictation){
    let f = document.activeElement;
    if(f && (f.tagName==="INPUT"||f.tagName==="TEXTAREA")){
      f.value += cmd + " ";
      return;
    }
  }

  // Click buttons
  if(cmd.startsWith("click")){
    let text = cmd.replace("click","").trim();
    document.querySelectorAll("button").forEach(b=>{
      if(b.innerText.toLowerCase().includes(text)){
        b.click();
        speak(text + " clicked");
      }
    });
    return;
  }

  // Type into active field
  if(cmd.startsWith("type")){
    let txt = cmd.replace("type","").trim();
    let f = document.activeElement;
    if(f && (f.tagName==="INPUT"||f.tagName==="TEXTAREA")){
      f.value += txt + " ";
      speak("Typed "+txt);
    }
    return;
  }

  // Emergency
  if(cmd.includes("emergency") || cmd.includes("help me")){
    speak("Emergency detected. Stay calm and seek help if needed.");
    return;
  }

  // Commands mapping
  const commands = {
    "start camera": openCamera,
    "stop camera": closeCamera,
    "start tracking": startTracking,
    "stop tracking": stopTracking,
    "dictation on": ()=>{dictation=true;speak("Dictation mode on")},
    "dictation off": ()=>{dictation=false;speak("Dictation mode off")},
    "submit": ()=>submitBtn.click(),
    "clear form": ()=>{name.value="";note.value="";speak("Form cleared")},
    "status": ()=>speak("System running normally"),
    "what time": ()=>speak("The time is "+new Date().toLocaleTimeString()),
    "what date": ()=>speak("Today is "+new Date().toDateString()),
    "help": ()=>speak("Say start camera, start tracking, dictation on, or emergency")
  };

  for(let k in commands){
    if(cmd.includes(k)){ commands[k](); return; }
  }

  speak("Command received but unclear");
}

/* ========= VOICE RECOGNITION ========= */
rec.onresult = e=>{
  let cmd = e.results[e.results.length-1][0].transcript.toLowerCase().trim();
  handle(cmd);
}

function startVoice(){
  rec.start();
  speak("Voice Assistant activated. You can control everything hands-free now.");
}
</script>

</body>
</html>
