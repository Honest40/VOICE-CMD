<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Voice Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#020617;
  color:#fff;
}
header{
  padding:15px;
  text-align:center;
  font-size:18px;
  border-bottom:1px solid #1e293b;
}
.container{padding:15px}
button{
  width:100%;
  padding:14px;
  margin-top:8px;
  font-size:16px;
  font-weight:bold;
  border:none;
  border-radius:8px;
}
.start{background:#22c55e;color:#000}
.stop{background:#ef4444;color:#fff}
.card{
  background:#020617;
  border:1px solid #1e293b;
  padding:12px;
  border-radius:10px;
  margin-top:12px;
}
.log{
  background:#000;
  padding:10px;
  border-radius:6px;
  font-size:14px;
  min-height:60px;
}
video{
  width:100%;
  border-radius:10px;
  display:none;
}
</style>
</head>
<body>

<header>üéô Advanced Smart Voice System</header>

<div class="container">
<button class="start" onclick="startListening()">‚ñ∂ Start Voice Control</button>
<button class="stop" onclick="stopListening()">‚õî Stop Voice Control</button>

<div class="card">
<b>Heard</b>
<div id="heard" class="log">Waiting‚Ä¶</div>
</div>

<div class="card">
<b>Response</b>
<div id="response" class="log">---</div>
</div>

<div class="card">
<b>üìç Location</b>
<div id="location" class="log">Inactive</div>
</div>

<div class="card">
<b>üé• Camera</b>
<video id="camera" autoplay playsinline></video>
</div>
</div>

<script>
/* ========= VOICE ENGINE ========= */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.continuous = true;
recognition.interimResults = false;
recognition.lang = navigator.language || "en-US";

/* ========= SPEECH OUTPUT ========= */
let muted=false;
function speak(text){
  if(muted) return;
  speechSynthesis.cancel();
  let msg=new SpeechSynthesisUtterance(text);
  msg.rate=1;
  msg.pitch=1;
  msg.lang=recognition.lang;
  speechSynthesis.speak(msg);
  response.innerText=text;
}

/* ========= LOCATION ========= */
let watchId=null;
function startTracking(){
  if(watchId) return;
  watchId=navigator.geolocation.watchPosition(pos=>{
    location.innerHTML=
      `Lat: ${pos.coords.latitude}<br>
       Lng: ${pos.coords.longitude}<br>
       Accuracy: ${pos.coords.accuracy}m`;
  });
  speak("Location tracking started");
}
function stopTracking(){
  navigator.geolocation.clearWatch(watchId);
  watchId=null;
  location.innerText="Stopped";
  speak("Location tracking stopped");
}

/* ========= CAMERA ========= */
let camStream=null;
async function openCamera(){
  if(camStream) return;
  camStream=await navigator.mediaDevices.getUserMedia({
    video:{facingMode:"user"},audio:false
  });
  camera.srcObject=camStream;
  camera.style.display="block";
  speak("Camera turned on");
}
function closeCamera(){
  if(!camStream) return;
  camStream.getTracks().forEach(t=>t.stop());
  camStream=null;
  camera.style.display="none";
  speak("Camera turned off");
}

/* ========= SMART INTENT MATCHING ========= */
function has(words,cmd){
  return words.some(w=>cmd.includes(w));
}

function handleCommand(cmd){
  heard.innerText=cmd;

  /* LOCATION */
  if(has(["track","location","position","where"],cmd) && has(["start","show","find","me"],cmd)){
    startTracking();
  }
  else if(has(["stop","end"],cmd) && has(["track","location"],cmd)){
    stopTracking();
  }

  /* CAMERA */
  else if(has(["open","start","turn"],cmd) && has(["camera"],cmd)){
    openCamera();
  }
  else if(has(["close","stop","off"],cmd) && has(["camera"],cmd)){
    closeCamera();
  }

  /* SYSTEM */
  else if(cmd.includes("time")){
    speak("The time is " + new Date().toLocaleTimeString());
  }
  else if(cmd.includes("date")){
    speak("Today is " + new Date().toDateString());
  }
  else if(cmd.includes("status")){
    speak("System running. Voice active.");
  }
  else if(cmd.includes("mute")){
    muted=true;
    response.innerText="Muted";
  }
  else if(cmd.includes("unmute")){
    muted=false;
    speak("System unmuted");
  }
  else if(cmd.includes("refresh")){
    speak("Refreshing");
    location.reload();
  }
  else if(cmd.includes("help")){
    speak("Say start tracking, open camera, what time is it, or status report");
  }
  else if(cmd.includes("emergency") || cmd.includes("help me")){
    speak("Emergency noted. Stay calm.");
  }
  else{
    speak("I heard you, but command is unclear");
  }
}

/* ========= START / STOP ========= */
recognition.onresult=e=>{
  let cmd=e.results[e.results.length-1][0].transcript
    .toLowerCase().trim();
  handleCommand(cmd);
};

function startListening(){
  recognition.start();
  speak("Advanced voice control activated");
}
function stopListening(){
  recognition.stop();
  speak("Voice control stopped");
}
</script>

</body>
</html>
